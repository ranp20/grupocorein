$(() =>{
  var locationsGET = window.location.href;
  var csrfTokenFrm = $(".subscriber-form").find("input[name='_token']").val();
  // ------------ FORMATO - SEPARADOR DE NÚMERO TELEFÓNICO(+51)
  $(document).on("keyup", "input[data-valformat=withspacesforthreenumbers]", function(e){
    let val = e.target.value;
    $(this).val(val.replace(/\D+/g, '').replace(/(\d{3})(\d{3})(\d{3})/, '$1 $2 $3'));
  });
  $(document).on("change", "#reg-slOpts__voucher", function(e){
    let optSel = $(this).val();
    // let tmpOptSel = ``;
    if(optSel == 1){
      $("#sl-docopts_conts").html(`
        <div class="row">
          <div class="col-sm-6">
            <div class="form-group">
              <label for="chckpay-firt_name">Nombres</label>
              <input class="form-control" name="chckpay_firt_name" type="text" id="chckpay-firt_name" value="" placeholder="Nombres" required>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label for="chckpay-dni">DNI</label>
              <input class="form-control" name="chckpay_dni" type="text" id="chckpay-dni" value="" placeholder="DNI" required>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <label for="chckpay-phone">Teléfono</label>
              <input class="form-control" name="chckpay_phone" type="text" id="chckpay-phone" value="" placeholder="Teléfono" required>
            </div>
          </div>
          <div class="col-12 d-flex align-items-center justify-content-start">
            <div class="form-group">
              <button type="submit" class="btn btn-primary d-flex align-items-center">
                <span>Confirmar Datos</span>
                <span class="cNxticon-i">
                  <svg xmlns:x="http://ns.adobe.com/Extensibility/1.0/" xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/" xmlns:graph="http://ns.adobe.com/Graphs/1.0/" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><switch><foreignObject requiredExtensions="http://ns.adobe.com/AdobeIllustrator/10.0/" x="0" y="0" width="1" height="1"/><g i:extraneous="self"><path d="M95.9,46.2L65.4,15.7c-2.1-2.1-5.5-2.1-7.5,0c-2.1,2.1-2.1,5.5,0,7.5l21.5,21.5H7.8c-2.9,0-5.3,2.4-5.3,5.3    c0,2.9,2.4,5.3,5.3,5.3h71.5L57.9,76.8c-2.1,2.1-2.1,5.5,0,7.5c1,1,2.4,1.6,3.8,1.6s2.7-0.5,3.8-1.6l30.6-30.6    c1-1,1.6-2.4,1.6-3.8C97.5,48.6,96.9,47.2,95.9,46.2z"/></g></switch></svg>
                </span>
              </button>
            </div>
          </div>
          <div class="col-12 d-flex align-items-center justify-content-start">
            <div class="form-group">
              <div class="btn btn-success d-flex align-items-center" disabled="disabled">
                <span>Finalizar compra</span>
                <span class="cNxticon-i">
                  <svg xmlns:x="http://ns.adobe.com/Extensibility/1.0/" xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/" xmlns:graph="http://ns.adobe.com/Graphs/1.0/" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><switch><foreignObject requiredExtensions="http://ns.adobe.com/AdobeIllustrator/10.0/" x="0" y="0" width="1" height="1"/><g i:extraneous="self"><path d="M95.9,46.2L65.4,15.7c-2.1-2.1-5.5-2.1-7.5,0c-2.1,2.1-2.1,5.5,0,7.5l21.5,21.5H7.8c-2.9,0-5.3,2.4-5.3,5.3    c0,2.9,2.4,5.3,5.3,5.3h71.5L57.9,76.8c-2.1,2.1-2.1,5.5,0,7.5c1,1,2.4,1.6,3.8,1.6s2.7-0.5,3.8-1.6l30.6-30.6    c1-1,1.6-2.4,1.6-3.8C97.5,48.6,96.9,47.2,95.9,46.2z"/></g></switch></svg>
                </span>
              </div>
            </div>
          </div>
        </div>
      `);
    }else if(optSel == 2){
      $("#sl-docopts_conts").html(`
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <label for="chckpay-ruc">RUC</label>
            <input class="form-control" name="chckpay-ruc" type="number" data-valformat="onlyintegers" id="chckpay-ruc" value="" placeholder="RUC" maxlength="11" required>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label for="chckpay-razonsocial">Razón Social</label>
            <input class="form-control" name="chckpay-razonsocial" type="text" id="chckpay-razonsocial" value="" placeholder="Razón Social" required>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label for="chckpay-address">Dirección</label>
            <input class="form-control" name="chckpay-address" type="text" id="chckpay-address" value="" placeholder="Dirección" required>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-group">
            <label for="chckpay-phone">Teléfono</label>
            <input class="form-control" name="chckpay-phone" type="text" data-valformat="withspacesforthreenumbers" id="chckpay-phone" value="" placeholder="Teléfono" maxlength="9" required>
          </div>
        </div>
        <div class="col-12 d-flex align-items-center justify-content-start">
          <div class="form-group">
            <button type="submit" class="btn btn-primary d-flex align-items-center">
              <span>Confirmar Datos</span>
              <span>
                <svg xmlns:x="http://ns.adobe.com/Extensibility/1.0/" xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/" xmlns:graph="http://ns.adobe.com/Graphs/1.0/" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><switch><foreignObject requiredExtensions="http://ns.adobe.com/AdobeIllustrator/10.0/" x="0" y="0" width="1" height="1"/><g i:extraneous="self"><path d="M95.9,46.2L65.4,15.7c-2.1-2.1-5.5-2.1-7.5,0c-2.1,2.1-2.1,5.5,0,7.5l21.5,21.5H7.8c-2.9,0-5.3,2.4-5.3,5.3    c0,2.9,2.4,5.3,5.3,5.3h71.5L57.9,76.8c-2.1,2.1-2.1,5.5,0,7.5c1,1,2.4,1.6,3.8,1.6s2.7-0.5,3.8-1.6l30.6-30.6    c1-1,1.6-2.4,1.6-3.8C97.5,48.6,96.9,47.2,95.9,46.2z"/></g></switch></svg>
              </span>
            </button>
          </div>
        </div>
        <div class="col-12 d-flex align-items-center justify-content-start">
          <div class="form-group">
            <div class="btn btn-success d-flex align-items-center" disabled="disabled">
              <span>Finalizar compra</span>
              <span class="cNxticon-i">
                <svg xmlns:x="http://ns.adobe.com/Extensibility/1.0/" xmlns:i="http://ns.adobe.com/AdobeIllustrator/10.0/" xmlns:graph="http://ns.adobe.com/Graphs/1.0/" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><switch><foreignObject requiredExtensions="http://ns.adobe.com/AdobeIllustrator/10.0/" x="0" y="0" width="1" height="1"/><g i:extraneous="self"><path d="M95.9,46.2L65.4,15.7c-2.1-2.1-5.5-2.1-7.5,0c-2.1,2.1-2.1,5.5,0,7.5l21.5,21.5H7.8c-2.9,0-5.3,2.4-5.3,5.3    c0,2.9,2.4,5.3,5.3,5.3h71.5L57.9,76.8c-2.1,2.1-2.1,5.5,0,7.5c1,1,2.4,1.6,3.8,1.6s2.7-0.5,3.8-1.6l30.6-30.6    c1-1,1.6-2.4,1.6-3.8C97.5,48.6,96.9,47.2,95.9,46.2z"/></g></switch></svg>
              </span>
            </div>
          </div>
        </div>
      </div>
      `);
    }else{
      $("#sl-docopts_conts").html("");
    }
  });
  $(document).on("click","#cTentr-af1698__1prevChckp",function(e){
    e.preventDefault();
    let dataHrefURL = $(this).data("href");

    var optionsPDFObject ={
      fallbackLink: "<p>Este navegador no admite archivos PDF en línea. Por favor descargue el PDF para verlo: <a href='[url]'>Descargar PDF</a></p>",
      width: "100%",
      height: "100%",
      omitInlineStyles: true,
      id: "myPDFIdOrder",
      pdfOpenParams:{
        view: 'FitV'
      }
    };

    $.ajax({
      headers:{
        'X-CSRF-TOKEN': csrfTokenFrm
      },
      type: 'POST',
      url: dataHrefURL,
      xhrFields:{
        responseType: 'blob'
      },
      success: function(blob, status, xhr){
        
        var filename = "";
        var disposition = xhr.getResponseHeader('Content-Disposition');
        if(disposition && disposition.indexOf('attachment') !== -1){
          var filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
          var matches = filenameRegex.exec(disposition);
          if(matches != null && matches[1]) filename = matches[1].replace(/['"]/g, '');
        }

        if(typeof window.navigator.msSaveBlob !== 'undefined'){
          window.navigator.msSaveBlob(blob, filename);
        }else{
          var URL = window.URL || window.webkitURL;
          var downloadUrl = URL.createObjectURL(blob);
          /*
          var blobNameObject = new Blob([filename],{type: 'application/pdf'});
          var urlNewName = window.URL.createObjectURL(blobNameObject);
          */
          /*
          var blob = blob.slice(0, blob.size, blob.type);
          var newFile = new File([blob], 'oiaisdsadsad.pdf',{type: 'application/pdf'});
          console.log("asdasdasd"+newFile);
          */
          let a = $("#cTentr-af1698__1prevChckpPDFDown");
          a.attr('href', downloadUrl);
          a.attr('download', 'previsualizacion_del_pedido.pdf');
          if(filename){            
            PDFObject.embed(downloadUrl, "#cTentr-af1698__1prevChckp-show", optionsPDFObject);
          }else{
            PDFObject.embed(downloadUrl, "#cTentr-af1698__1prevChckp-show", optionsPDFObject);
          }
          PDFObject.embed(downloadUrl, "#cTentr-af1698__1prevChckp-show", optionsPDFObject);
        }       
      }
    });
  });  
  // ------------ FORMATO - SOLO NÚMEROS ENTEROS POSITIVOS
  (function($){
    $.fn.inputFilter = function(callback, errMsg){
      return this.on("input keydown keyup mousedown mouseup select contextmenu drop focusout", function(e){
        if(callback(this.value)){
          // Accepted value
          if(["keydown","mousedown","focusout"].indexOf(e.type) >= 0){
            $(this).removeClass("input-error");
            $("#spn-fgTchkMdl23_transaction").text("");
            this.setCustomValidity("");
          }
          this.oldValue = this.value;
          this.oldSelectionStart = this.selectionStart;
          this.oldSelectionEnd = this.selectionEnd;
          console.log($(this).length);
        } else if(this.hasOwnProperty("oldValue")){
          // Rejected value - restore the previous one
          $(this).addClass("input-error");
          $("#spn-fgTchkMdl23_transaction").text("Solo se permiten números*");
          this.setCustomValidity(errMsg);
          this.reportValidity();
          this.value = this.oldValue;
          this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
        } else{
          // Rejected value - nothing to restore
          this.value = "";
        }
      });
    };
  }(jQuery));
  $(document).ready(function(){
    $("input[data-valformat=onlyintegers]").inputFilter(function(value){
      return /^\d*$/.test(value); // Permitir solo dígitos, usando RegExp
    },"Solo se permiten números");
  });
  // --------- VALIDACIÓN DE DATOS "COMPROBANTE DE PAGO"
  $(document).on("submit","form#dft443__gH09-checkoutvoucher", function(e){
    e.preventDefault();
    console.log("Enviar datos al controlador de guardado de datos del voucher");
  });
});

